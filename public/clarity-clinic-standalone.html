<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClarityClinic - Standalone</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossOrigin="anonymous" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Source+Code+Pro:wght@400;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@3.6.0/cdn.min.js"></script>

    <style>
        :root {
            --background: 220 56% 8%;
            --foreground: 220 14% 91%;
            --card: 222 47% 11%;
            --card-foreground: 220 14% 91%;
            --popover: 222 47% 11%;
            --popover-foreground: 220 14% 91%;
            --primary: 195 78% 50%;
            --primary-foreground: 220 56% 8%;
            --secondary: 222 47% 11%;
            --secondary-foreground: 220 14% 91%;
            --muted: 221 18% 65%;
            --muted-foreground: 221 18% 65%;
            --accent: 165 48% 40%;
            --accent-foreground: 220 56% 8%;
            --destructive: 350 88% 70%;
            --destructive-foreground: 0 0% 98%;
            --border: 221 21% 28%;
            --input: 220 43% 10%;
            --ring: 195 78% 50%;
            --radius: 1rem;
        }

        *, ::before, ::after { box-sizing: border-box; border-width: 0; border-style: solid; border-color: hsl(var(--border)); }
        html { line-height: 1.5; -webkit-text-size-adjust: 100%; -moz-tab-size: 4; tab-size: 4; font-family: 'Inter', sans-serif; }
        body { margin: 0; line-height: inherit; font-family: 'Inter', sans-serif; background-color: hsl(var(--background)); color: hsl(var(--foreground)); -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        h1, h2, h3, h4, h5, h6 { font-size: inherit; font-weight: inherit; }
        a { color: inherit; text-decoration: inherit; }
        button, input, optgroup, select, textarea { font-family: inherit; font-feature-settings: inherit; font-variation-settings: inherit; font-size: 100%; font-weight: inherit; line-height: inherit; color: inherit; margin: 0; padding: 0; }
        button, [role="button"] { cursor: pointer; }
        table { text-indent: 0; border-color: inherit; border-collapse: collapse; }
        input::placeholder, textarea::placeholder { opacity: 1; color: hsl(var(--muted-foreground)); }
        
        .main-container { display: flex; min-height: 100vh; }
        .sidebar { display: flex; flex-direction: column; width: 256px; background: linear-gradient(180deg, #0d1424, #0b1220 40%); border-right: 1px solid hsl(var(--border)); padding: 1rem; box-shadow: 0 1px 12px rgba(34,211,238,0.07); }
        .main-content { flex: 1; display: flex; flex-direction: column; }
        .page { display: none; padding: 2rem; }
        .page:target { display: block; }
        .page:not(:target) { display: none; }
        #dashboard { display: block; } /* Show dashboard by default */

        .logo-container { display: grid; place-items: center; width: 40px; height: 40px; border-radius: 0.5rem; border: 1px solid hsla(var(--border), 0.5); background: linear-gradient(to bottom right, hsla(195, 78%, 50%, 0.2), transparent, hsla(165, 48%, 40%, 0.2)); }
        .logo-svg { width: 20px; height: 20px; stroke: hsl(var(--primary)); stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }
        .sidebar-header { display: flex; align-items: center; gap: 0.75rem; }
        .sidebar-header-text h1 { font-size: 1.25rem; font-weight: 700; color: white; }
        .sidebar-header-text p { font-size: 0.75rem; color: hsl(var(--muted-foreground)); }
        .sidebar nav { margin-top: 1.5rem; display: flex; flex-direction: column; gap: 0.25rem; }
        .nav-link { display: flex; align-items: center; justify-content: flex-start; gap: 0.75rem; height: 44px; padding: 0 0.75rem; border-radius: 0.5rem; text-decoration: none; color: hsl(var(--muted-foreground)); transition: all 0.2s; }
        .nav-link:hover { color: hsl(var(--primary)); background-color: hsla(var(--primary), 0.1); }
        .nav-link.active { background-color: hsla(var(--primary), 0.2); color: hsl(var(--foreground)); border: 1px solid hsla(var(--primary), 0.3); }
        .nav-link svg { width: 20px; height: 20px; }
        .sidebar-footer { margin-top: auto; display: flex; flex-direction: column; gap: 0.75rem; }
        
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; white-space: nowrap; border-radius: 0.375rem; font-size: 0.875rem; font-weight: 500; transition: color, background-color 0.2s; height: 40px; padding: 0 1rem; }
        .btn-primary { background-color: hsl(var(--primary)); color: hsl(var(--primary-foreground)); }
        .btn-primary:hover { background-color: hsla(var(--primary), 0.9); }
        .btn-outline { border: 1px solid hsl(var(--input)); background-color: hsl(var(--background)); }
        .btn-outline:hover { background-color: hsl(var(--accent)); color: hsl(var(--accent-foreground)); }
        .btn-destructive { background-color: hsl(var(--destructive)); color: hsl(var(--destructive-foreground)); }
        .btn-destructive:hover { background-color: hsla(var(--destructive), 0.9); }
        .btn:disabled { pointer-events: none; opacity: 0.5; }
        
        .card { border-radius: 1rem; border: 1px solid hsl(var(--border)); background-color: hsl(var(--card)); color: hsl(var(--card-foreground)); box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06); }
        .card-header { padding: 1.5rem; }
        .card-title { font-size: 1.5rem; font-weight: 600; line-height: 1; letter-spacing: -0.025em; }
        .card-description { color: hsl(var(--muted-foreground)); font-size: 0.875rem; }
        .card-content { padding: 1.5rem; padding-top: 0; }
        .card-footer { display: flex; align-items: center; padding: 1.5rem; padding-top: 0; }

        .grid { display: grid; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .gap-8 { gap: 2rem; }
        .md-grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .lg-grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .lg-grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        .md-col-span-2 { grid-column: span 2 / span 2; }
        .lg-col-span-2 { grid-column: span 2 / span 2; }
        .lg-col-span-3 { grid-column: span 3 / span 3; }
        
        .form-item { display: flex; flex-direction: column; gap: 0.5rem; }
        .form-label { font-size: 0.875rem; font-weight: 500; }
        .form-input, .form-select { display: flex; height: 40px; width: 100%; border-radius: 0.375rem; border: 1px solid hsl(var(--input)); background-color: hsl(var(--background)); padding: 0.5rem 0.75rem; font-size: 0.875rem; }
        .form-input:focus-visible, .form-select:focus-visible { outline: 2px solid hsl(var(--ring)); outline-offset: 2px; }
        .form-textarea { min-height: 80px; }
        .form-message { font-size: 0.875rem; font-weight: 500; color: hsl(var(--destructive)); }
        
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .justify-end { justify-content: flex-end; }
        .space-y-6 > :not([hidden]) ~ :not([hidden]) { margin-top: 1.5rem; }
        .pb-2 { padding-bottom: 0.5rem; }
        .text-sm { font-size: 0.875rem; }
        .font-medium { font-weight: 500; }
        .text-3xl { font-size: 1.875rem; }
        .font-bold { font-weight: 700; }
        .text-muted-foreground { color: hsl(var(--muted-foreground)); }
        .text-xs { font-size: 0.75rem; }
        .text-emerald-400 { color: #34d399; }
        .text-rose-400 { color: #fb7185; }
        .text-cyan-400 { color: #22d3ee; }

        .tabs { }
        .tabs-list { display: inline-flex; height: 40px; align-items: center; justify-content: center; border-radius: 0.375rem; background-color: hsl(var(--muted)); padding: 0.25rem; color: hsl(var(--muted-foreground)); margin-bottom: 1rem; }
        .tabs-trigger { display: inline-flex; align-items: center; justify-content: center; white-space: nowrap; border-radius: 0.25rem; padding: 0.375rem 0.75rem; font-size: 0.875rem; font-weight: 500; cursor: pointer; }
        .tabs-trigger.active { background-color: hsl(var(--background)); color: hsl(var(--foreground)); box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .tabs-content { display: none; }
        .tabs-content.active { display: block; }
        
        table { width: 100%; caption-side: bottom; font-size: 0.875rem; }
        thead tr { border-bottom: 1px solid hsl(var(--border)); }
        th { height: 48px; padding: 0 1rem; text-align: left; vertical-align: middle; font-weight: 500; color: hsl(var(--muted-foreground)); }
        tbody tr { border-bottom: 1px solid hsl(var(--border)); transition: background-color 0.2s; }
        tbody tr:last-child { border-bottom: 0; }
        tbody tr:hover { background-color: hsla(var(--muted), 0.5); }
        td { padding: 1rem; vertical-align: middle; }
        .text-right { text-align: right; }
        
        .badge { display: inline-flex; align-items: center; border-radius: 9999px; border: 1px solid transparent; padding: 0.125rem 0.625rem; font-size: 0.75rem; font-weight: 600; }
        .badge.income { background-color: hsla(145, 63%, 42%, 0.2); color: #34d399; border-color: hsla(145, 63%, 42%, 0.3); }
        .badge.expense { background-color: hsla(347, 83%, 62%, 0.2); color: #fb7185; border-color: hsla(347, 83%, 62%, 0.3); }
        .badge.confirmed { background-color: hsl(var(--secondary)); color: hsl(var(--secondary-foreground)); }
        .badge.completed { background-color: hsl(var(--primary)); color: hsl(var(--primary-foreground)); }
        .badge.cancelled { background-color: hsl(var(--destructive)); color: hsl(var(--destructive-foreground)); }

        .btn-ghost { background: transparent; border: 0; }
        .btn-ghost:hover { background-color: hsl(var(--accent)); color: hsl(var(--accent-foreground)); }
        .btn-icon { width: 40px; height: 40px; padding: 0; }
        
        .dropdown { position: relative; display: inline-block; }
        .dropdown-content { display: none; position: absolute; right: 0; background-color: hsl(var(--popover)); min-width: 160px; border: 1px solid hsl(var(--border)); border-radius: 0.5rem; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 1; padding: 0.25rem; }
        .dropdown:hover .dropdown-content { display: block; }
        .dropdown-item { display: flex; align-items: center; gap: 0.5rem; color: hsl(var(--foreground)); padding: 0.5rem; font-size: 0.875rem; text-decoration: none; border-radius: 0.25rem; cursor: pointer; }
        .dropdown-item:hover { background-color: hsl(var(--accent)); color: hsl(var(--accent-foreground)); }
        .dropdown-item.destructive { color: hsl(var(--destructive)); }
        .dropdown-item.destructive:hover { background-color: hsla(var(--destructive), 0.1); }
        
        .separator { height: 1px; width: 100%; background-color: hsl(var(--border)); margin: 0.5rem 0; }
        
        /* Modal for Date Picker */
        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); }
        .modal-content { background-color: hsl(var(--card)); margin: 10% auto; padding: 20px; border: 1px solid hsl(var(--border)); width: 80%; max-width: 600px; border-radius: 1rem; }
        .rdp { --rdp-cell-size: 40px; --rdp-accent-color: hsl(var(--primary)); --rdp-background-color: hsla(var(--primary), 0.1); --rdp-accent-color-dark: hsl(var(--primary)); --rdp-background-color-dark: hsla(var(--primary), 0.1); --rdp-outline: 2px solid var(--rdp-accent-color); --rdp-outline-selected: 3px solid var(--rdp-accent-color); --rdp-border-radius: 0.5rem; }

        /* Spinner */
        .spinner { animation: spin 1s linear infinite; width: 1rem; height: 1rem; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="main-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo-container">
                    <svg class="logo-svg" viewBox="0 0 24 24" fill="none" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2v20M2 12h20"/>
                    </svg>
                </div>
                <div class="sidebar-header-text">
                    <h1>ClarityClinic</h1>
                    <p>Standalone App</p>
                </div>
            </div>

            <nav id="main-nav">
                <a href="#dashboard" class="nav-link active">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>
                    <span>Dashboard</span>
                </a>
                <a href="#transactions" class="nav-link">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>
                    <span>Transactions</span>
                </a>
                <a href="#appointments" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M10 14h4"/><path d="M10 18h7"/><path d="m3 18 2-2 2 2"/></svg>
                    <span>Appointments</span>
                </a>
                <a href="#prescriptions" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M9.5 13.5c.71.5 1.39 1.14 2 2 .61-.86 1.29-1.5 2-2"/><path d="M12 19.5v-5"/></svg>
                    <span>Prescriptions</span>
                </a>
                <a href="#inventory" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
                    <span>Inventory</span>
                </a>
                 <a href="#reports" class="nav-link">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M18 17v-6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v6"/><path d="M13 5v4"/><path d="M8 5v2"/></svg>
                    <span>Reports</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <a href="#add-transaction" class="btn btn-primary">
                   <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                    New Transaction
                </a>
                <div class="separator"></div>
                <button id="load-sample-btn" class="btn btn-outline">Load Sample Data</button>
                <button id="clear-data-btn" class="btn btn-destructive">Clear All Data</button>
            </div>
        </aside>

        <main class="main-content">
            <!-- DASHBOARD -->
            <section id="dashboard" class="page">
                <div class="space-y-6">
                    <div class="grid gap-4 md-grid-cols-2 lg-grid-cols-3" id="kpi-cards">
                        <!-- KPI Cards will be rendered here -->
                    </div>
                    <div class="grid gap-6 md-grid-cols-2">
                        <div class="card md-col-span-2">
                            <div class="card-header"><h3 class="card-title">Monthly Income vs. Expense</h3></div>
                            <div class="card-content"><canvas id="monthly-chart"></canvas></div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- TRANSACTIONS -->
            <section id="transactions" class="page">
                <div class="card">
                    <div class="card-header"><h3 class="card-title">All Transactions</h3></div>
                    <div class="card-content">
                        <table>
                            <thead>
                                <tr><th>Date</th><th>Type</th><th class="text-right">Amount</th><th>Category</th><th>Notes</th><th class="text-right">Actions</th></tr>
                            </thead>
                            <tbody id="transactions-table-body">
                                <!-- Transaction rows will be rendered here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- ADD TRANSACTION -->
            <section id="add-transaction" class="page">
                <div class="card">
                    <div class="card-header"><h3 class="card-title">Add New Transaction</h3></div>
                    <div class="card-content">
                        <form id="add-transaction-form" class="space-y-6">
                            <div class="grid gap-8 lg-grid-cols-4">
                                <div class="form-item"><label for="tx-date" class="form-label">Date</label><input type="date" id="tx-date" name="date" class="form-input" required></div>
                                <div class="form-item"><label for="tx-type" class="form-label">Type</label><select id="tx-type" name="type" class="form-select" required><option>Income</option><option>Expense</option></select></div>
                                <div class="form-item"><label for="tx-amount" class="form-label">Amount</label><input type="number" step="0.01" id="tx-amount" name="amount" class="form-input" placeholder="0.00" required></div>
                                <div class="form-item">
                                    <label for="tx-category" class="form-label">Category</label>
                                    <select id="tx-category" name="category" class="form-select" required>
                                        <option value="">Select a category</option>
                                        <option>Consultation</option><option>Procedure</option><option>Diagnostics</option><option>Pharmacy</option><option>Supplies</option><option>Rent</option><option>Utilities</option><option>Staff</option><option>Misc</option>
                                    </select>
                                </div>
                                <div class="form-item md-col-span-2 lg-col-span-4">
                                    <label for="tx-notes" class="form-label">Notes</label>
                                    <textarea id="tx-notes" name="notes" class="form-input form-textarea" placeholder="Add transaction details..."></textarea>
                                </div>
                            </div>
                            <div class="flex justify-end gap-4"><button type="reset" class="btn btn-outline">Reset</button><button type="submit" class="btn btn-primary">Save Transaction</button></div>
                        </form>
                    </div>
                </div>
            </section>
            
            <!-- APPOINTMENTS -->
            <section id="appointments" class="page">
                <div class="tabs">
                    <div class="tabs-list" id="appointments-tabs-list">
                        <button class="tabs-trigger active" data-tab="appointments-list">View Appointments</button>
                        <button class="tabs-trigger" data-tab="appointments-add">Add Appointment</button>
                    </div>
                    <div id="appointments-list" class="tabs-content active">
                        <div class="card">
                            <div class="card-header"><h3 class="card-title">All Appointments</h3></div>
                            <div class="card-content">
                                <table>
                                    <thead><tr><th>Date</th><th>Time</th><th>Patient</th><th>Doctor</th><th>Reason</th><th>Status</th><th class="text-right">Actions</th></tr></thead>
                                    <tbody id="appointments-table-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div id="appointments-add" class="tabs-content">
                        <div class="card">
                            <div class="card-header"><h3 class="card-title">Add New Appointment</h3></div>
                            <div class="card-content">
                                <form id="add-appointment-form" class="space-y-6">
                                    <div class="grid gap-8 lg-grid-cols-3">
                                        <div class="form-item"><label class="form-label">Date</label><input type="date" name="date" class="form-input" required></div>
                                        <div class="form-item"><label class="form-label">Time</label><input type="time" name="time" class="form-input" required></div>
                                        <div class="form-item"><label class="form-label">Patient Name</label><input type="text" name="patient" class="form-input" required></div>
                                        <div class="form-item"><label class="form-label">Doctor</label><input type="text" name="doctor" class="form-input" required></div>
                                        <div class="form-item lg-col-span-2"><label class="form-label">Reason</label><input type="text" name="reason" class="form-input" required></div>
                                        <div class="form-item">
                                            <label class="form-label">Status</label>
                                            <select name="status" class="form-select" required><option>Confirmed</option><option>Completed</option><option>Cancelled</option></select>
                                        </div>
                                    </div>
                                    <div class="flex justify-end gap-4"><button type="reset" class="btn btn-outline">Reset</button><button type="submit" class="btn btn-primary">Save Appointment</button></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- PRESCRIPTIONS -->
            <section id="prescriptions" class="page">
                 <div class="tabs">
                    <div class="tabs-list" id="prescriptions-tabs-list">
                        <button class="tabs-trigger active" data-tab="prescriptions-list">View Prescriptions</button>
                        <button class="tabs-trigger" data-tab="prescriptions-add">Add Prescription</button>
                    </div>
                    <div id="prescriptions-list" class="tabs-content active">
                        <div class="card">
                            <div class="card-header"><h3 class="card-title">All Prescriptions</h3></div>
                            <div class="card-content">
                                <table>
                                    <thead><tr><th>Date</th><th>Doctor</th><th>Patient</th><th>Medicine</th><th>Quantity</th><th>Notes</th><th class="text-right">Actions</th></tr></thead>
                                    <tbody id="prescriptions-table-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div id="prescriptions-add" class="tabs-content">
                       <div class="card">
                            <div class="card-header"><h3 class="card-title">Add New Prescription</h3></div>
                            <div class="card-content">
                                <form id="add-prescription-form" class="space-y-6">
                                    <div class="grid gap-8 lg-grid-cols-3">
                                        <div class="form-item"><label class="form-label">Date</label><input type="date" name="date" class="form-input" required></div>
                                        <div class="form-item"><label class="form-label">Doctor</label><input type="text" name="doctor" class="form-input" required></div>
                                        <div class="form-item"><label class="form-label">Patient</label><input type="text" name="patient" class="form-input" required></div>
                                        <div class="form-item">
                                            <label class="form-label">Medicine</label>
                                            <select name="medicine" id="prescription-medicine-select" class="form-select" required></select>
                                        </div>
                                        <div class="form-item"><label class="form-label">Quantity</label><input type="number" name="quantity" class="form-input" required min="1"></div>
                                        <div class="form-item lg-col-span-3"><label class="form-label">Notes</label><textarea name="notes" class="form-input form-textarea"></textarea></div>
                                    </div>
                                    <div class="flex justify-end gap-4"><button type="reset" class="btn btn-outline">Reset</button><button type="submit" class="btn btn-primary">Save Prescription</button></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- INVENTORY -->
            <section id="inventory" class="page">
                <div class="tabs">
                    <div class="tabs-list" id="inventory-tabs-list">
                        <button class="tabs-trigger active" data-tab="inventory-list">View Inventory</button>
                        <button class="tabs-trigger" data-tab="inventory-add">Add Item</button>
                    </div>
                    <div id="inventory-list" class="tabs-content active">
                        <div class="card">
                            <div class="card-header"><h3 class="card-title">Pharmacy Inventory</h3></div>
                            <div class="card-content">
                                <table>
                                    <thead><tr><th>Medicine</th><th>Batch</th><th>Expiry</th><th>Quantity</th><th>Supplier</th><th class="text-right">Actions</th></tr></thead>
                                    <tbody id="inventory-table-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div id="inventory-add" class="tabs-content">
                        <div class="card">
                            <div class="card-header"><h3 class="card-title">Add New Inventory Item</h3></div>
                            <div class="card-content">
                                <form id="add-inventory-form" class="space-y-6">
                                    <div class="grid gap-8 md-grid-cols-2">
                                        <div class="form-item"><label class="form-label">Medicine Name</label><input type="text" name="name" class="form-input" required></div>
                                        <div class="form-item"><label class="form-label">Batch No.</label><input type="text" name="batch" class="form-input" required></div>
                                        <div class="form-item"><label class="form-label">Expiry Date</label><input type="date" name="expiry" class="form-input" required></div>
                                        <div class="form-item"><label class="form-label">Quantity</label><input type="number" name="quantity" class="form-input" required min="0"></div>
                                        <div class="form-item"><label class="form-label">Total Price (Optional)</label><input type="number" name="price" step="0.01" class="form-input" placeholder="Records an expense if set"></div>
                                        <div class="form-item"><label class="form-label">Supplier (Optional)</label><input type="text" name="supplier" class="form-input"></div>
                                    </div>
                                    <div class="flex justify-end gap-4"><button type="reset" class="btn btn-outline">Reset</button><button type="submit" class="btn btn-primary">Save Item</button></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- REPORTS -->
            <section id="reports" class="page">
                <div class="space-y-6">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Profit & Loss Statement</h3>
                            <p class="card-description">Select a date range to generate a financial report.</p>
                        </div>
                        <div class="card-content">
                            <form id="report-form" class="flex items-center gap-4">
                                <div class="form-item"><label class="form-label">Start Date</label><input type="date" id="report-start-date" class="form-input"></div>
                                <div class="form-item"><label class="form-label">End Date</label><input type="date" id="report-end-date" class="form-input"></div>
                                <button type="submit" class="btn btn-primary" style="align-self: flex-end;">Generate Report</button>
                            </form>
                        </div>
                    </div>

                    <div id="report-results-container" style="display: none;">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Report Results</h3>
                                <p class="card-description" id="report-period-description"></p>
                            </div>
                            <div class="card-content">
                                <table id="pnl-table">
                                    <thead><tr><th>Description</th><th class="text-right">Amount</th></tr></thead>
                                    <tbody id="pnl-table-body"></tbody>
                                    <tfoot>
                                        <tr style="border-top: 2px solid hsl(var(--primary) / 0.5);">
                                            <td class="font-bold">Net Profit / Loss</td>
                                            <td class="text-right font-bold" id="pnl-net-profit"></td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CORE APP LOGIC ---
            const state = {
                transactions: [],
                appointments: [],
                prescriptions: [],
                inventory: [],
                currency: { value: 'INR', label: 'INR (₹)', symbol: '₹', locale: 'en-IN' }
            };

            const db = {
                load: () => {
                    const data = localStorage.getItem('clarityClinicStandalone');
                    if (data) {
                        const parsedData = JSON.parse(data);
                        Object.assign(state, parsedData);
                    }
                },
                save: () => {
                    localStorage.setItem('clarityClinicStandalone', JSON.stringify(state));
                }
            };
            
            const render = () => {
                renderDashboard();
                renderTransactions();
                renderAppointments();
                renderPrescriptions();
                renderInventory();
                populatePrescriptionMedicineSelect();
            };

            const init = () => {
                db.load();
                setupEventListeners();
                render();
                navigateTo(location.hash || '#dashboard');
            };

            // --- NAVIGATION ---
            const setupEventListeners = () => {
                const navLinks = document.querySelectorAll('#main-nav .nav-link');
                navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        const targetId = link.getAttribute('href');
                        navigateTo(targetId);
                    });
                });
                
                const tabsLists = document.querySelectorAll('.tabs-list');
                tabsLists.forEach(list => {
                    list.addEventListener('click', (e) => {
                        if (e.target.classList.contains('tabs-trigger')) {
                            const tabId = e.target.dataset.tab;
                            const parentTabs = e.target.closest('.tabs');
                            
                            parentTabs.querySelectorAll('.tabs-trigger').forEach(t => t.classList.remove('active'));
                            e.target.classList.add('active');
                            
                            parentTabs.querySelectorAll('.tabs-content').forEach(c => c.classList.remove('active'));
                            document.getElementById(tabId).classList.add('active');
                        }
                    });
                });

                document.getElementById('add-transaction-form').addEventListener('submit', handleAddTransaction);
                document.getElementById('add-appointment-form').addEventListener('submit', handleAddAppointment);
                document.getElementById('add-prescription-form').addEventListener('submit', handleAddPrescription);
                document.getElementById('add-inventory-form').addEventListener('submit', handleAddInventory);
                document.getElementById('report-form').addEventListener('submit', handleGenerateReport);
                document.getElementById('load-sample-btn').addEventListener('click', seedData);
                document.getElementById('clear-data-btn').addEventListener('click', clearData);
            };

            const navigateTo = (hash) => {
                document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
                const targetPage = document.querySelector(hash);
                if (targetPage) {
                    targetPage.style.display = 'block';
                } else {
                    document.querySelector('#dashboard').style.display = 'block';
                    hash = '#dashboard';
                }
                
                document.querySelectorAll('#main-nav .nav-link').forEach(l => l.classList.remove('active'));
                const activeLink = document.querySelector(`#main-nav a[href="${hash}"]`);
                if(activeLink) activeLink.classList.add('active');

                location.hash = hash;
            };

            const formatCurrency = (amount) => {
                return new Intl.NumberFormat(state.currency.locale, {
                    style: 'currency',
                    currency: state.currency.value,
                }).format(amount);
            };
            
            // --- SEED & CLEAR DATA ---
            const seedData = () => {
                if (!confirm('This will add sample data. Are you sure?')) return;
                const today = new Date();
                const iso = (d) => d.toISOString().slice(0, 10);
                const sampleTransactions = [
                  { id: Date.now() + 1, date: iso(new Date(today.getFullYear(), today.getMonth() - 2, 3)), type: 'Income', amount: 800, category: 'Consultation', notes: 'General checkup' },
                  { id: Date.now() + 2, date: iso(new Date(today.getFullYear(), today.getMonth() - 2, 9)), type: 'Expense', amount: 250, category: 'Supplies', notes: 'Syringes & gloves' },
                  { id: Date.now() + 3, date: iso(new Date(today.getFullYear(), today.getMonth() - 1, 12)), type: 'Income', amount: 4000, category: 'Procedure', notes: 'Minor surgery' },
                  { id: Date.now() + 4, date: iso(new Date(today.getFullYear(), today.getMonth() - 1, 15)), type: 'Expense', amount: 1500, category: 'Staff', notes: 'Assistant salary (partial)' },
                  { id: Date.now() + 5, date: iso(new Date(today.getFullYear(), today.getMonth(), 5)), type: 'Expense', amount: 2200, category: 'Rent', notes: 'Clinic rent' },
                ];
                const sampleInventory = [
                    { id: Date.now() + 6, name: "Paracetamol 500mg", batch: "P500-01", expiry: iso(new Date(today.getFullYear() + 1, 5, 1)), quantity: 200, supplier: "Pharma Inc." },
                    { id: Date.now() + 7, name: "Amoxicillin 250mg", batch: "AMX250-05", expiry: iso(new Date(today.getFullYear() + 2, 1, 1)), quantity: 150, supplier: "MediSupply" },
                    { id: Date.now() + 8, name: "Cough Syrup", batch: "CS-11", expiry: iso(new Date(today.getFullYear() + 1, 11, 1)), quantity: 50, supplier: "MediSupply" },
                ];
                state.transactions.push(...sampleTransactions);
                state.inventory.push(...sampleInventory);
                db.save();
                render();
                alert('Sample data loaded!');
            };
            
            const clearData = () => {
                if (confirm('Are you sure you want to delete ALL data? This cannot be undone.')) {
                    state.transactions = [];
                    state.appointments = [];
                    state.prescriptions = [];
                    state.inventory = [];
                    db.save();
                    render();
                    alert('All data has been cleared.');
                }
            };
            
            // --- DASHBOARD ---
            let monthlyChartInstance = null;
            const renderDashboard = () => {
                const kpiCards = document.getElementById('kpi-cards');
                const income = state.transactions.filter(t => t.type === 'Income').reduce((acc, t) => acc + t.amount, 0);
                const expense = state.transactions.filter(t => t.type === 'Expense').reduce((acc, t) => acc + t.amount, 0);
                const net = income - expense;

                kpiCards.innerHTML = `
                    <div class="card"><div class="card-header flex items-center justify-between pb-2"><h3 class="card-title text-sm font-medium">Total Income</h3></div><div class="card-content"><div class="text-3xl font-bold text-emerald-400">${formatCurrency(income)}</div></div></div>
                    <div class="card"><div class="card-header flex items-center justify-between pb-2"><h3 class="card-title text-sm font-medium">Total Expenses</h3></div><div class="card-content"><div class="text-3xl font-bold text-rose-400">${formatCurrency(expense)}</div></div></div>
                    <div class="card"><div class="card-header flex items-center justify-between pb-2"><h3 class="card-title text-sm font-medium">Net Income</h3></div><div class="card-content"><div class="text-3xl font-bold ${net >= 0 ? 'text-emerald-400' : 'text-rose-400'}">${formatCurrency(net)}</div></div></div>
                `;

                const monthlyData = {};
                state.transactions.forEach(tx => {
                    const month = dateFns.format(new Date(tx.date), 'MMM yyyy');
                    if (!monthlyData[month]) monthlyData[month] = { income: 0, expense: 0 };
                    if (tx.type === 'Income') monthlyData[month].income += tx.amount;
                    else monthlyData[month].expense += tx.amount;
                });
                
                const sortedMonths = Object.keys(monthlyData).sort((a,b) => new Date(a) - new Date(b));
                
                const chartCtx = document.getElementById('monthly-chart').getContext('2d');
                if (monthlyChartInstance) monthlyChartInstance.destroy();
                monthlyChartInstance = new Chart(chartCtx, {
                    type: 'bar',
                    data: {
                        labels: sortedMonths,
                        datasets: [
                            { label: 'Income', data: sortedMonths.map(m => monthlyData[m].income), backgroundColor: 'hsla(145, 63%, 42%, 0.8)' },
                            { label: 'Expense', data: sortedMonths.map(m => monthlyData[m].expense), backgroundColor: 'hsla(347, 83%, 62%, 0.8)' }
                        ]
                    },
                    options: { scales: { y: { beginAtZero: true } } }
                });
            };

            // --- TRANSACTIONS ---
            const renderTransactions = () => {
                const tbody = document.getElementById('transactions-table-body');
                tbody.innerHTML = state.transactions.sort((a,b) => new Date(b.date) - new Date(a.date)).map(tx => `
                    <tr>
                        <td>${tx.date}</td>
                        <td><span class="badge ${tx.type.toLowerCase()}">${tx.type}</span></td>
                        <td class="text-right ${tx.type === 'Income' ? 'text-emerald-400' : 'text-rose-400'}">${formatCurrency(tx.amount)}</td>
                        <td>${tx.category}</td>
                        <td>${tx.notes || '-'}</td>
                        <td class="text-right">
                           <div class="dropdown">
                               <button class="btn btn-ghost btn-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="19" cy="12" r="1"/><circle cx="5" cy="12" r="1"/></svg>
                               </button>
                               <div class="dropdown-content">
                                   <a class="dropdown-item destructive" onclick="window.clarityApp.deleteTransaction(${tx.id})">
                                       <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
                                       Delete
                                   </a>
                               </div>
                           </div>
                        </td>
                    </tr>
                `).join('');
                if (state.transactions.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; height: 96px;">No transactions found.</td></tr>';
                }
            };
            
            const handleAddTransaction = (e) => {
                e.preventDefault();
                const form = e.target;
                const formData = new FormData(form);
                const newTx = {
                    id: Date.now(),
                    date: formData.get('date'),
                    type: formData.get('type'),
                    amount: parseFloat(formData.get('amount')),
                    category: formData.get('category'),
                    notes: formData.get('notes'),
                };
                state.transactions.push(newTx);
                db.save();
                render();
                form.reset();
                navigateTo('#transactions');
            };

            window.clarityApp = {
                deleteTransaction: (id) => {
                    if (confirm('Are you sure you want to delete this transaction?')) {
                        state.transactions = state.transactions.filter(tx => tx.id !== id);
                        db.save();
                        render();
                    }
                }
            };
            
            // --- APPOINTMENTS ---
            const renderAppointments = () => {
                const tbody = document.getElementById('appointments-table-body');
                tbody.innerHTML = state.appointments.sort((a,b) => new Date(b.date) - new Date(a.date)).map(a => `
                    <tr>
                        <td>${a.date}</td><td>${a.time}</td><td>${a.patient}</td><td>${a.doctor}</td><td>${a.reason}</td>
                        <td><span class="badge ${a.status.toLowerCase()}">${a.status}</span></td>
                        <td class="text-right"><button class="btn btn-ghost btn-icon destructive" onclick="window.clarityApp.deleteAppointment(${a.id})">Delete</button></td>
                    </tr>
                `).join('');
                 if (state.appointments.length === 0) tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; height: 96px;">No appointments found.</td></tr>';
            };
            const handleAddAppointment = (e) => {
                e.preventDefault();
                const form = e.target;
                const formData = new FormData(form);
                state.appointments.push({ id: Date.now(), ...Object.fromEntries(formData.entries()) });
                db.save();
                render();
                form.reset();
                document.querySelector('[data-tab="appointments-list"]').click();
            };
            window.clarityApp.deleteAppointment = (id) => {
                if(confirm('Delete appointment?')) { state.appointments = state.appointments.filter(a => a.id !== id); db.save(); render(); }
            };
            
            // --- PRESCRIPTIONS ---
            const renderPrescriptions = () => {
                 const tbody = document.getElementById('prescriptions-table-body');
                tbody.innerHTML = state.prescriptions.sort((a,b) => new Date(b.date) - new Date(a.date)).map(p => `
                    <tr>
                        <td>${p.date}</td><td>${p.doctor}</td><td>${p.patient}</td><td>${p.medicine}</td><td>${p.quantity}</td><td>${p.notes || '-'}</td>
                        <td class="text-right"><button class="btn btn-ghost btn-icon destructive" onclick="window.clarityApp.deletePrescription(${p.id})">Delete</button></td>
                    </tr>
                `).join('');
                 if (state.prescriptions.length === 0) tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; height: 96px;">No prescriptions found.</td></tr>';
            };
             const populatePrescriptionMedicineSelect = () => {
                const select = document.getElementById('prescription-medicine-select');
                select.innerHTML = '<option value="">Select from inventory...</option>' + state.inventory
                    .filter(i => i.quantity > 0)
                    .map(i => `<option value="${i.name}">${i.name} (${i.quantity} left)</option>`)
                    .join('');
            };
            const handleAddPrescription = (e) => {
                e.preventDefault();
                const form = e.target;
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());
                
                const invItem = state.inventory.find(i => i.name === data.medicine);
                if (!invItem) { alert('Medicine not found in inventory.'); return; }
                if (invItem.quantity < data.quantity) { alert(`Not enough stock for ${data.medicine}. Only ${invItem.quantity} left.`); return; }
                
                invItem.quantity -= parseInt(data.quantity, 10);
                state.prescriptions.push({ id: Date.now(), ...data });
                db.save();
                render();
                form.reset();
                document.querySelector('[data-tab="prescriptions-list"]').click();
            };
            window.clarityApp.deletePrescription = (id) => {
                 if(confirm('Delete prescription? Note: This does not restock inventory.')) { state.prescriptions = state.prescriptions.filter(p => p.id !== id); db.save(); render(); }
            };
            
            // --- INVENTORY ---
            const renderInventory = () => {
                const tbody = document.getElementById('inventory-table-body');
                tbody.innerHTML = state.inventory.sort((a,b) => a.name.localeCompare(b.name)).map(i => `
                    <tr>
                        <td>${i.name}</td><td>${i.batch}</td><td>${i.expiry}</td><td>${i.quantity}</td><td>${i.supplier || '-'}</td>
                        <td class="text-right"><button class="btn btn-ghost btn-icon destructive" onclick="window.clarityApp.deleteInventoryItem(${i.id})">Delete</button></td>
                    </tr>
                `).join('');
                if (state.inventory.length === 0) tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; height: 96px;">No inventory items found.</td></tr>';
            };
            const handleAddInventory = (e) => {
                e.preventDefault();
                const form = e.target;
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());
                const price = parseFloat(data.price);
                delete data.price;

                state.inventory.push({ id: Date.now(), ...data, quantity: parseInt(data.quantity, 10) });
                
                if (price > 0) {
                     state.transactions.push({ id: Date.now() + 1, date: new Date().toISOString().slice(0, 10), type: 'Expense', amount: price, category: 'Supplies', notes: `Purchased ${data.quantity} x ${data.name}` });
                }

                db.save();
                render();
                form.reset();
                document.querySelector('[data-tab="inventory-list"]').click();
            };
            window.clarityApp.deleteInventoryItem = (id) => {
                if(confirm('Delete inventory item?')) { state.inventory = state.inventory.filter(i => i.id !== id); db.save(); render(); }
            };

            // --- REPORTS ---
            const handleGenerateReport = (e) => {
                e.preventDefault();
                const startDate = new Date(document.getElementById('report-start-date').value);
                const endDate = new Date(document.getElementById('report-end-date').value);
                
                if (isNaN(startDate) || isNaN(endDate)) { alert('Please select a valid date range.'); return; }
                endDate.setHours(23, 59, 59, 999); // Include the whole end day

                const filteredTx = state.transactions.filter(tx => {
                    const txDate = new Date(tx.date);
                    return txDate >= startDate && txDate <= endDate;
                });

                const incomeByCategory = {};
                const expenseByCategory = {};
                let totalIncome = 0;
                let totalExpense = 0;
                
                filteredTx.forEach(tx => {
                    const category = tx.category;
                    if (tx.type === "Income") {
                        incomeByCategory[category] = (incomeByCategory[category] || 0) + tx.amount;
                        totalIncome += tx.amount;
                    } else {
                        expenseByCategory[category] = (expenseByCategory[category] || 0) + tx.amount;
                        totalExpense += tx.amount;
                    }
                });

                const tbody = document.getElementById('pnl-table-body');
                tbody.innerHTML = `
                    <tr style="font-weight: bold; background-color: hsla(var(--muted), 0.2);"><td colspan="2">Income</td></tr>
                    ${Object.entries(incomeByCategory).map(([name, total]) => `<tr><td style="padding-left: 2rem;">${name}</td><td class="text-right">${formatCurrency(total)}</td></tr>`).join('')}
                    <tr style="background-color: hsla(var(--muted), 0.1);"><td style="padding-left: 2rem; font-weight: bold;">Total Income</td><td class="text-right font-bold text-emerald-400">${formatCurrency(totalIncome)}</td></tr>
                    
                    <tr style="font-weight: bold; background-color: hsla(var(--muted), 0.2);"><td colspan="2">Expenses</td></tr>
                     ${Object.entries(expenseByCategory).map(([name, total]) => `<tr><td style="padding-left: 2rem;">${name}</td><td class="text-right">${formatCurrency(total)}</td></tr>`).join('')}
                    <tr style="background-color: hsla(var(--muted), 0.1);"><td style="padding-left: 2rem; font-weight: bold;">Total Expenses</td><td class="text-right font-bold text-rose-400">${formatCurrency(totalExpense)}</td></tr>
                `;

                const netProfit = totalIncome - totalExpense;
                const netProfitEl = document.getElementById('pnl-net-profit');
                netProfitEl.textContent = formatCurrency(netProfit);
                netProfitEl.className = `text-right font-bold ${netProfit >= 0 ? 'text-emerald-400' : 'text-rose-400'}`;

                document.getElementById('report-period-description').textContent = `Showing data from ${dateFns.format(startDate, 'PPP')} to ${dateFns.format(endDate, 'PPP')}`;
                document.getElementById('report-results-container').style.display = 'block';
            };


            init();
        });
    </script>
</body>
</html>
